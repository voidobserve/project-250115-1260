C51 COMPILER V9.60.7.0   TEMPERATURE_ADJUST                                                06/13/2025 15:15:03 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TEMPERATURE_ADJUST
OBJECT MODULE PLACED IN .\Release\Objects\temperature_adjust.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\temperature_adjust.c LARGE OPTIMIZE(8,SPEED) BROWSE INTVECTOR
                    -(0X000C) INCDIR(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\temperature_
                    -adjust.lst) OBJECT(.\Release\Objects\temperature_adjust.obj)

line level    source

   1          #include "user_config.h"
   2          #include "temperature_adjust.h"
   3          
   4          extern bit ex_temp_en; // è¿‡æ¸©é™åŠŸç‡æ ‡å¿—ä½
   5          extern bit ex_temp_en; // è¿‡æ¸©é™åŠŸç‡æ ‡å¿—ä½
   6          extern struct
   7          {
   8              u32 t;    // è®¡æ—¶å™¨
   9              u8 level; // æ—¶ç©ºåˆ—è¡¨æ‰§è¡Œçš„å“ªä¸€ä¸ªæ—¶é—´æ®µ
  10              u8 list;  // æ—¶æ§åˆ—è¡¨ï¼Œ5ä¸ªåˆ—è¡¨
  11              u8 en;    // ä½¿èƒ½
  12          } t_ctrl;
  13          extern bit extemp_tctrl_flag;
  14          extern u16 ntc_val; // å­˜æ”¾æ±‚å¹³å‡ä¹‹åï¼Œå¾—åˆ°çš„adå€¼
  15          // extern u8 ex_temp_state; // æ ‡å¿—ä½ï¼Œæ¸©åº¦æ‰«æçš„åŠä¸ªå°æ—¶æ˜¯å¦åˆ°æ¥
  16          extern u16 max_duty; // å¯è°ƒçš„æœ€å¤§å ç©ºæ¯”
  17          // extern u16 ex_duty;      // æ¸©åº¦æ§åˆ¶ä¸­ï¼Œå­˜æ”¾ç»è¿‡æ¸©åº¦é™åˆ¶åï¼Œå¯è°ƒçš„ã€æœ€å¤§çš„pwmå 
             -ç©ºæ¯”
  18          // extern bit extemp_flag;  // æ ‡å¿—ä½ï¼Œæ˜¯å¦æ£€æµ‹åˆ°æ¸©åº¦è¿‡çƒ­
  19          extern bit adjust_en;
  20          extern u32 pwm_in_duty_xuwei;
  21          extern struct
  22          {
  23              u8 en;
  24          } _3_1;
  25          extern u16 ajust_duty;
  26          extern u32 ex_pwm_in_duty;
  27          extern u16 ex_max_duty;
  28          extern bit is_pwr_down;
  29          
  30          // volatile u32 temperature_scan_cnt = 0;                        // æ¸©åº¦æ‰«ææ—¶é—´è®¡æ•°ï¼Œåœ¨å®šæ—¶å™
             -¨ä¸­ç´¯åŠ 
  31          volatile u32 temperature_over_heat_cnt = 0;                   // æ¸©åº¦è¿‡çƒ­æ—¶é—´è®¡æ•°ï¼Œåœ¨å®šæ—¶å™¨ä¸
             -­ç´¯åŠ 
  32          volatile u8 cur_temperature_status = TEMPERATURE_STATUS_NONE; // çŠ¶æ€æœºï¼Œè®°å½•å½“å‰æ¸©åº¦çŠ¶æ€
  33          
  34          // è¿‡æ¸©é™åŠŸç‡ å®šæ—¶åˆ¤æ–­ æ¯ç§’æ‰§è¡Œä¸€æ¬¡
  35          // æ¸©åº¦æ£€æµ‹ï¼Œè¿›è€Œè°ƒèŠ‚pwmçš„åŠŸèƒ½ï¼Œç”±å®šæ—¶å™¨è°ƒç”¨æ‰«æ
  36          void temperature_scan_isr(void)
  37          {
  38   1          static u16 __sec_cnt = 0; // ä¸ºäº†é€‚é…åŸæœ‰çš„æ¡†æ¶ï¼ŒåŠ å…¥äº†è¯¥å˜é‡ï¼Œè¿›è¡ŒåŠå°æ—¶è®¡æ—¶
  39   1          if (cur_temperature_status == TEMPERATURE_STATUS_NONE)
  40   1          {
  41   2              if (__sec_cnt < 65535) // é˜²æ­¢è®¡æ•°æº¢å‡º
  42   2              {
  43   3                  __sec_cnt++;
  44   3              }
  45   2          }
  46   1          else
  47   1          {
  48   2              // å¦‚æœæ¸©åº¦ä»¥åŠè¿‡çƒ­ï¼Œä¸ä½¿ç”¨è¯¥å˜é‡
  49   2              __sec_cnt = 0;
  50   2          }
C51 COMPILER V9.60.7.0   TEMPERATURE_ADJUST                                                06/13/2025 15:15:03 PAGE 2   

  51   1      
  52   1          // å¦‚æœä½¿èƒ½äº†æ¸©åº¦æ£€æµ‹åŠŸèƒ½ å¹¶ä¸” æ—¶æ§åŠŸèƒ½ æœªä½¿èƒ½
  53   1          if (ex_temp_en == 1 && t_ctrl.en == 0)
  54   1          {
  55   2              if (TEMPERATURE_STATUS_NONE == cur_temperature_status) // å¦‚æœæ¸©åº¦æœªè¿‡çƒ­
  56   2              {
  57   3                  // å¦‚æœæ£€æµ‹åˆ°æ¸©åº¦è¿‡å¤§
  58   3                  if (ntc_val < _3_1V)
  59   3                  {
  60   4                      // æ›´æ–°å¯è°ƒçš„æœ€å¤§å ç©ºæ¯”
  61   4                      max_duty = PWM_DUTY_50_PERCENT;
  62   4                      cur_temperature_status = TEMPERATURE_STATUS_OVER_HEAT_0MIN;
  63   4                  }
  64   3                  else // æ¸©åº¦æ­£å¸¸ ä¸å¹²é¢„æœ€å¤§å€¼ å¹¶ä¸”è®¡æ•°ç½®0
  65   3                  {
  66   4                      if (__sec_cnt >= ((u16)60 * 30)) // 60 sec * 30 == 30 min
  67   4                      {
  68   5                          // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°æ¸©åº¦è¿‡çƒ­ï¼Œå¹¶ä¸”åŠä¸ªå°æ—¶çš„æ‰«æå‘¨æœŸåˆ°æ¥
  69   5                          __sec_cnt = 0;
  70   5      
  71   5                          if (extemp_tctrl_flag == 0)
  72   5                          {
  73   6                              if (adjust_en == 1)
  74   6                              {
  75   7                                  if (_3_1.en == 1)
  76   7                                  {
  77   8                                      max_duty = pwm_in_duty_xuwei;
  78   8                                  }
  79   7                                  else
  80   7                                  {
  81   8                                      max_duty = ajust_duty;
  82   8                                  }
  83   7                              }
  84   6      
  85   6                              if (adjust_en == 0)
  86   6                              {
  87   7                                  if (_3_1.en == 1)
  88   7                                  {
  89   8                                      max_duty = ex_pwm_in_duty;
  90   8                                  }
  91   7                                  else
  92   7                                  {
  93   8                                      // max_duty = pwm_save[0];
  94   8                                  }
  95   7                              }
  96   6      
  97   6                              if (P00 == 0)
  98   6                              {
  99   7                                  if (max_duty > ex_max_duty)
 100   7                                  {
 101   8                                      max_duty = ex_max_duty;
 102   8                                  }
 103   7                              }
 104   6                          }
 105   5      
 106   5                          if (extemp_tctrl_flag == 1)
 107   5                          {
 108   6                              extemp_tctrl_flag = 0;
 109   6                              return;
 110   6                          }
 111   5                      } // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°æ¸©åº¦è¿‡çƒ­ï¼Œå¹¶ä¸”åŠä¸ªå°æ—¶çš„æ‰«æå‘¨æœŸåˆ°æ¥
 112   4                  }
C51 COMPILER V9.60.7.0   TEMPERATURE_ADJUST                                                06/13/2025 15:15:03 PAGE 3   

 113   3              }
 114   2              else if (TEMPERATURE_STATUS_OVER_HEAT_0MIN == cur_temperature_status) // æ£€æµ‹åˆ°æ¸©åº¦è¿‡çƒ­ä¸€æ
             -¬¡
 115   2              {
 116   3                  // åŸæ¥çš„æ¡†æ¶é‡Œæœ‰ç»™ max_duty èµ‹å€¼çš„è¯­å¥ï¼Œä¸çŸ¥é“ä¼šä¸ä¼šæœ‰å†²çªï¼Œè¿™é‡Œä¸€
             -ç›´ç»™ max_duty èµ‹å€¼
 117   3                  max_duty = PWM_DUTY_50_PERCENT;
 118   3      
 119   3                  // if (temperature_over_heat_cnt >= ((u32)300000)) // 5min
 120   3                  if (temperature_over_heat_cnt >= ((u32)5 * 60 * 1000)) // 5min
 121   3                  {
 122   4                      // è¿‡çƒ­5minåï¼Œè·³è½¬åˆ°å¯¹åº”çš„è¯­å¥å—è¿›è¡Œå¤„ç†
 123   4                      cur_temperature_status = TEMPERATURE_STATUS_OVER_HEAT_5MIN;
 124   4                  }
 125   3              }
 126   2              else if (TEMPERATURE_STATUS_OVER_HEAT_5MIN == cur_temperature_status) // æ£€æµ‹åˆ°æ¸©åº¦è¿‡çƒ­ç´¯è
             -®¡5min
 127   2              {
 128   3                  /*
 129   3                      æ ‡å¿—ä½ï¼Œæ˜¯å¦çœŸçš„è¿‡çƒ­
 130   3                      åœ¨è¯¥è¯­å¥å—å†…åå¤å¯¹æ¯” æ£€æµ‹åˆ°çš„adå€¼ï¼Œå¦‚æœä»è¿‡çƒ­ï¼Œå°†pwmé™åˆ¶ä¸º 25%
 131   3                  */
 132   3                  static bit flag_is_really_over_heat = 0;
 133   3      
 134   3                  if (ntc_val < _3_1V) // å¦‚æœä»è¿‡çƒ­
 135   3                  {
 136   4                      flag_is_really_over_heat = 1;
 137   4                  }
 138   3      
 139   3                  if (flag_is_really_over_heat)
 140   3                  {
 141   4                      max_duty = PWM_DUTY_25_PERCENT;
 142   4                  }
 143   3              }
 144   2      
 145   2              if (extemp_tctrl_flag == 1)
 146   2              {
 147   3                  extemp_tctrl_flag = 0;
 148   3              }
 149   2          }
 150   1      
 151   1          is_pwr_down = 1; // ä½¿èƒ½ç¼“æ…¢å‡é™åŠŸç‡ï¼Œç»™æ ‡å¿—ä½ç½®ä¸€
 152   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    326    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
